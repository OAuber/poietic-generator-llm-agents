<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® AI Player - Poietic Generator</title>
    <link rel="stylesheet" href="css/llm-player.css">
    <style>
        .image-samples {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .image-sample-item {
            border: 1px solid #333;
            border-radius: 6px;
            padding: 8px;
            background: #1a1a1a;
        }
        
        .image-sample-title {
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .image-sample-thumbnail {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .image-sample-thumbnail:hover {
            opacity: 0.8;
        }
        
        .image-sample-placeholder {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .image-sample-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        
        .image-sample-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
        }
        
        .image-sample-btn:hover {
            background: #45a049;
        }
        
        .image-sample-btn.secondary {
            background: #666;
        }
        
        .image-sample-btn.secondary:hover {
            background: #777;
        }

        /* Modal pour afficher les images en grand */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            cursor: pointer;
        }

        .image-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
        }

        .image-modal img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #fff;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
        }

        .image-modal-close:hover {
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Panneau Viewer -->
        <div class="viewer-panel">
            <iframe id="viewer-frame" src="/viewer2"></iframe>
        </div>

        <!-- Panneau de contr√¥le -->
        <div class="control-panel">
            <div class="header">
                üé® AI Player - Poietic Generator
            </div>

            <!-- Configuration -->
            <div class="section">
                <div class="section-title">üîë Configuration</div>
                
                <div class="input-group">
                    <label>Mod√®le LLM</label>
                    <select id="llm-model-select">
                        <option value="ollama">ü¶ô Ollama Llama3.2 3B (Gratuit, OVH GPU)</option>
                        <option value="llava" selected>üëÅÔ∏è LLaVA 7B Vision (Gratuit, OVH GPU)</option>
                        <option value="anthropic">ü§ñ Anthropic Claude 3.5 Sonnet</option>
                        <option value="openai">üîÆ OpenAI GPT-4</option>
                        <option value="claude-vision" disabled>üëÅÔ∏è Claude Vision (bient√¥t disponible)</option>
                        <option value="dalle" disabled>üé® DALL-E 3 (bient√¥t disponible)</option>
                        <option value="gemini" disabled>üíé Google Gemini (bient√¥t disponible)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>API Key</label>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <input type="password" id="api-key" placeholder="sk-ant-api03-..." style="flex: 1;">
                        <button id="btn-clear-key" style="flex: none; width: auto; padding: 10px 12px; background: #555; font-size: 12px;" title="Effacer la cl√©">üóëÔ∏è</button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Viewer URL <span class="viewer-url-toggle" id="toggle-viewer-url">‚ñº Changer</span></label>
                    <select id="viewer-url" style="display: none;">
                        <option value="/viewer">Viewer (avec initial state)</option>
                        <option value="/viewer2" selected>Viewer2 (fond noir - LLM)</option>
                        <option value="http://localhost:3001/viewer">Local viewer (localhost:3001)</option>
                        <option value="http://localhost:3001/viewer2">Local viewer2 (localhost:3001)</option>
                        <option value="https://poietic-generator.net/viewer">Production (poietic-generator.net)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>D√©lai apr√®s it√©ration (s)</label>
                    <input type="number" id="interval" value="0" min="0" max="60">
                </div>

                <div class="input-group">
                    <label>Prompt personnalis√© (optionnel)</label>
                    <textarea id="custom-prompt" placeholder="(Optionnel) Laissez vide pour libert√© totale, sans suggestion."></textarea>
                    <button id="btn-submit-prompt" class="secondary" style="margin-top: 8px; width: 100%;">üì§ Envoyer prompt</button>
                </div>

                <div class="button-group">
                    <button id="btn-start">‚ñ∂ D√©marrer</button>
                    <button id="btn-pause" class="secondary" disabled>‚è∏ Pause</button>
                </div>
            </div>

            <!-- Mode toggle button -->
            <div class="section">
                <div class="button-group">
                    <button id="toggle-mode-btn">Mode libre collaboratif</button>
                </div>
            </div>

            <!-- Exercices (Entra√Ænement) -->
            <div class="section" id="training-panel" style="display: none;">
                <div class="section-title">üß™ Exercices (Entra√Ænement)</div>
                <div class="input-group" style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; align-items:center;">
                    <label><input type="checkbox" id="training-enabled"> Activer l'entra√Ænement</label>
                    <span style="font-size:11px; color:#888;">Le prompt sera g√©n√©r√© selon la phase/exercice</span>
                    <div>
                        <label>Phase</label>
                        <select id="training-phase">
                            <option value="A">Phase A ‚Äî Dessin guid√©</option>
                            <option value="B">Phase B ‚Äî Copie</option>
                            <option value="C">Phase C ‚Äî Cr√©ation guid√©e</option>
                            <option value="D">Phase D ‚Äî Interaction</option>
                        </select>
                    </div>
                    <div>
                        <label>Exercice</label>
                        <select id="training-ex">
                            <option value="A1">A1 ‚Äî Coins+centre impos√©s</option>
                            <option value="A2">A2 ‚Äî Coins+centre, couleurs libres</option>
                            <option value="A3">A3 ‚Äî Coins+centre, positions libres</option>
                            <option value="A4">A4 ‚Äî Damier 2 couleurs</option>
                            <option value="A5">A5 ‚Äî Damier couleurs invers√©es</option>
                            <option value="B6">B6 ‚Äî Copier voisin cardinal</option>
                            <option value="B7">B7 ‚Äî Miroir voisin cardinal</option>
                            <option value="B8">B8 ‚Äî Copier voisin diagonal + rotation</option>
                            <option value="C9">C9 ‚Äî D√©grad√© centre‚Üíbord</option>
                            <option value="C10">C10 ‚Äî Paysage stylis√©</option>
                            <option value="C11">C11 ‚Äî Visage sur paysage</option>
                            <option value="D12">D12 ‚Äî Compl√©ter motif voisin</option>
                            <option value="D13">D13 ‚Äî Passerelle entre voisins</option>
                            <option value="D14">D14 ‚Äî Dessin libre</option>
                        </select>
                    </div>
                </div>
                <div class="input-group" style="display:flex; gap:8px; align-items:center; margin-top:8px;">
                    <button id="btn-training-approve" class="secondary" title="Valider l'exercice" style="display:none;">‚úÖ Valider exercice</button>
                    <button id="btn-training-reject" class="secondary" title="Rejeter et r√©essayer" style="display:none;">‚Ü©Ô∏è Rejeter</button>
                    <span id="training-validation-hint" style="font-size:11px; color:#888; display:none;">Validation manuelle requise pour cet exercice</span>
                </div>
            </div>

            <!-- √âtat -->
            <div class="section">
                <div class="section-title">üìä √âtat</div>
                <div class="decision-box" style="margin-top:12px;">
                    <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                        <span class="status-badge disconnected" id="status-badge">D√©connect√©</span>
                        <span class="status-badge disconnected" id="llm-status-badge">LLM: Inactif</span>
                        <span style="margin-left:auto; font-size:11px; color:#888;" id="user-id-display">‚Äî</span>
                        <span style="font-size:11px; color:#888;" id="llm-model">claude-3-5-sonnet-20241022</span>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; font-size:12px; color:#ccc;">
                        <div>Tokens IN (derni√®re): <b id="tokens-in-last">0</b></div>
                        <div>Tokens OUT (derni√®re): <b id="tokens-out-last">0</b></div>
                        <div>Tokens IN (total): <b id="tokens-in-total">0</b></div>
                        <div>Tokens OUT (total): <b id="tokens-out-total">0</b></div>
                    </div>
                </div>
            </div>

            <!-- Derni√®re d√©cision -->
            <div class="section">
                <div class="section-title">ü§ñ Derni√®re d√©cision</div>
                <div class="decision-box" id="decision-box">
                    <div class="decision-strategy">En attente...</div>
                    <div class="decision-meta"></div>
                </div>
            </div>

            <!-- √âchantillons d'images LLaVA -->
            <div class="section">
                <div class="section-title">üì∏ Images envoy√©es √† LLaVA</div>
                <div class="image-samples" id="image-samples">
                    <div class="image-sample-placeholder">Aucune image envoy√©e</div>
                </div>
            </div>

            <!-- Journal -->
            <div class="section">
                <div class="section-title">üìú Journal</div>
                <div class="journal" id="journal">
                    <div class="journal-entry">En attente de connexion...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour afficher les images en grand -->
    <div id="image-modal" class="image-modal">
        <span class="image-modal-close">&times;</span>
        <div class="image-modal-content">
            <img id="modal-image" src="" alt="Image LLaVA">
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/spatial-analysis.js?v=20250116-49"></script>
    <script type="module" src="js/llm-adapters/anthropic.js?v=20250116-49"></script>
    <script type="module" src="js/llm-adapters/ollama.js?v=20250116-49"></script>
    <script type="module" src="js/llm-adapters/llava.js?v=20250116-49"></script>
    <script type="module" src="js/llava-canvas.js?v=20250116-49"></script>
    <script type="module" src="js/ai-player.js?v=20250116-49"></script>
</body>
</html>
# Architecture des formats de donnÃ©es - Poietic Generator

## ğŸ“Š Vue d'ensemble

Le systÃ¨me utilise **deux formats distincts** pour optimiser la communication rÃ©seau (JSON) et la consommation de tokens LLM (format compact).

---

## ğŸ—ï¸ SCHÃ‰MA DE L'ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NAVIGATEUR (Frontend)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚   AI Player      â”‚         â”‚  Human Player    â”‚                      â”‚
â”‚  â”‚  (ai-player.js)  â”‚         â”‚(poietic-client.js)â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚           â”‚                             â”‚                                â”‚
â”‚           â”‚ Format: JSON                â”‚ Format: JSON                   â”‚
â”‚           â”‚ {"type": "cell_update",     â”‚ {"type": "cell_update",        â”‚
â”‚           â”‚  "sub_x": 10,               â”‚  "sub_x": 5,                   â”‚
â”‚           â”‚  "sub_y": 5,                â”‚  "sub_y": 8,                   â”‚
â”‚           â”‚  "color": "#3498DB"}        â”‚  "color": "#E74C3C"}           â”‚
â”‚           â”‚                             â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚ WebSocket (JSON)                              â”‚
â”‚                          â–¼                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVEUR CRYSTAL (Backend)                             â”‚
â”‚                  (poietic-generator-api.cr)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  WebSocket Handler (/updates)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. ReÃ§oit: JSON individuel                                      â”‚    â”‚
â”‚  â”‚    {"type": "cell_update", "sub_x": 10, "sub_y": 5, ...}       â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚ 2. Enrichit avec user_id et timestamp                           â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚ 3. Broadcast: JSON enrichi                                      â”‚    â”‚
â”‚  â”‚    {"type": "cell_update",                                      â”‚    â”‚
â”‚  â”‚     "user_id": "abc123",                                        â”‚    â”‚
â”‚  â”‚     "sub_x": 10,                                                â”‚    â”‚
â”‚  â”‚     "sub_y": 5,                                                 â”‚    â”‚
â”‚  â”‚     "color": "#3498DB",                                         â”‚    â”‚
â”‚  â”‚     "timestamp": 1234567890}                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚ Broadcast (JSON) Ã  tous les clients           â”‚
â”‚                          â–¼                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NAVIGATEUR (Frontend)                                 â”‚
â”‚                   RÃ©ception des updates                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  AI Player (ai-player.js)                                        â”‚   â”‚
â”‚  â”‚  handleWebSocketMessage()                                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  case 'cell_update':                                             â”‚   â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚    â”‚ Stockage en mÃ©moire (JSON â†’ Objet JS)                â”‚    â”‚   â”‚
â”‚  â”‚    â”‚                                                        â”‚    â”‚   â”‚
â”‚  â”‚    â”‚ this.otherUsers[user_id].recentUpdates.push({        â”‚    â”‚   â”‚
â”‚  â”‚    â”‚   x: message.sub_x,        // 10                     â”‚    â”‚   â”‚
â”‚  â”‚    â”‚   y: message.sub_y,        // 5                      â”‚    â”‚   â”‚
â”‚  â”‚    â”‚   color: message.color,    // "#3498DB"             â”‚    â”‚   â”‚
â”‚  â”‚    â”‚   timestamp: Date.now()                              â”‚    â”‚   â”‚
â”‚  â”‚    â”‚ });                                                   â”‚    â”‚   â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚ Quand l'agent doit analyser                   â”‚
â”‚                          â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Spatial Analysis (spatial-analysis.js)                          â”‚   â”‚
â”‚  â”‚  analyzeNeighbors()                                              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  AgrÃ©gation pour le LLM (Objet JS â†’ Format compact)             â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  neighbors[dir] = {                                              â”‚   â”‚
â”‚  â”‚    pixel_count: 45,                                              â”‚   â”‚
â”‚  â”‚    recent_updates: [                                             â”‚   â”‚
â”‚  â”‚      {x: 10, y: 5, color: "#3498DB"},                           â”‚   â”‚
â”‚  â”‚      {x: 12, y: 8, color: "#E74C3C"}                            â”‚   â”‚
â”‚  â”‚    ],                                                             â”‚   â”‚
â”‚  â”‚    last_strategy: "je dessine un carrÃ©"                          â”‚   â”‚
â”‚  â”‚  }                                                                â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Ollama Adapter (ollama.js)                                      â”‚   â”‚
â”‚  â”‚  buildSystemPrompt()                                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Conversion en format compact pour Ã©conomiser les tokens         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  const updateStr = updates.map(u =>                              â”‚   â”‚
â”‚  â”‚    `${u.x},${u.y}:${u.color}`  // Format compact !              â”‚   â”‚
â”‚  â”‚  ).join(' ');                                                     â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  RÃ©sultat: "10,5:#3498DB 12,8:#E74C3C"                          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  Prompt envoyÃ© au LLM:                                           â”‚   â”‚
â”‚  â”‚  "N: 45px total | Derniers changements: 10,5:#3498DB 12,8:..."  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚ HTTP POST (JSON)                              â”‚
â”‚                          â–¼                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SERVEUR PYTHON (AI Server)                              â”‚
â”‚                  (poietic_ai_server.py)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  POST /api/llm/ollama                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ReÃ§oit: JSON avec prompt contenant format compact               â”‚    â”‚
â”‚  â”‚ {                                                                â”‚    â”‚
â”‚  â”‚   "model": "llama3.2:3b",                                        â”‚    â”‚
â”‚  â”‚   "messages": [{                                                 â”‚    â”‚
â”‚  â”‚     "role": "user",                                              â”‚    â”‚
â”‚  â”‚     "content": "VOISINS: N: 45px | 10,5:#3498DB 12,8:#E74C3C"  â”‚    â”‚
â”‚  â”‚   }]                                                             â”‚    â”‚
â”‚  â”‚ }                                                                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                                â”‚
â”‚                          â”‚ HTTP POST (JSON)                              â”‚
â”‚                          â–¼                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OLLAMA (OVH AI Deploy)                                â”‚
â”‚                    llama3.2:3b                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  Le LLM lit le format compact dans le prompt:                            â”‚
â”‚  "10,5:#3498DB 12,8:#E74C3C"                                            â”‚
â”‚                                                                           â”‚
â”‚  Et gÃ©nÃ¨re une rÃ©ponse JSON:                                             â”‚
â”‚  {                                                                        â”‚
â”‚    "strategy": "Je prolonge le motif bleu de mon voisin",               â”‚
â”‚    "pixels": [                                                            â”‚
â”‚      {"x": 10, "y": 6, "color": "#3498DB"},                             â”‚
â”‚      {"x": 11, "y": 6, "color": "#3498DB"}                              â”‚
â”‚    ]                                                                      â”‚
â”‚  }                                                                        â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ RÃ©ponse (JSON)
                           â–¼
                    (Remonte la chaÃ®ne)
```

---

## ğŸ“‹ TABLEAU RÃ‰CAPITULATIF DES FORMATS

| Ã‰tape | Composant | Format | Exemple | Raison |
|-------|-----------|--------|---------|--------|
| **1. Ã‰mission** | `ai-player.js` â†’ Serveur Crystal | **JSON** | `{"type": "cell_update", "sub_x": 10, "sub_y": 5, "color": "#3498DB"}` | Standard WebSocket, interopÃ©rabilitÃ© |
| **2. Broadcast** | Serveur Crystal â†’ Tous les clients | **JSON enrichi** | `{"type": "cell_update", "user_id": "abc123", "sub_x": 10, "sub_y": 5, "color": "#3498DB", "timestamp": 1234567890}` | Ajout mÃ©tadonnÃ©es, traÃ§abilitÃ© |
| **3. Stockage local** | `ai-player.js` (mÃ©moire) | **Objet JS** | `{x: 10, y: 5, color: "#3498DB", timestamp: 1697123456}` | Structure native JavaScript |
| **4. AgrÃ©gation** | `spatial-analysis.js` | **Objet JS** | `{pixel_count: 45, recent_updates: [{x: 10, y: 5, color: "#3498DB"}], ...}` | Analyse spatiale |
| **5. Prompt LLM** | `ollama.js` â†’ Prompt | **Format compact** | `"N: 45px \| 10,5:#3498DB 12,8:#E74C3C"` | **Ã‰conomie de tokens** |
| **6. RequÃªte API** | Frontend â†’ AI Server | **JSON** | `{"model": "llama3.2:3b", "messages": [...]}` | Standard HTTP/REST |
| **7. RÃ©ponse LLM** | Ollama â†’ AI Server | **JSON** | `{"strategy": "...", "pixels": [...]}` | Format structurÃ©, parsable |

---

## ğŸ” COMPARAISON DES FORMATS

### Format JSON (WebSocket)
```json
{
  "type": "cell_update",
  "user_id": "abc123",
  "sub_x": 10,
  "sub_y": 5,
  "color": "#3498DB",
  "timestamp": 1234567890
}
```
**Taille** : ~120 caractÃ¨res  
**Usage** : Communication rÃ©seau, dÃ©bogage, traÃ§abilitÃ©  
**Avantages** : StructurÃ©, typÃ©, extensible, standard

### Format compact (Prompt LLM)
```
10,5:#3498DB
```
**Taille** : ~13 caractÃ¨res  
**Usage** : Prompt LLM uniquement  
**Avantages** : **90% plus compact**, lisible par humain et LLM

### Ã‰conomie de tokens
- **JSON** : `{"x": 10, "y": 5, "color": "#3498DB"}` = ~35 caractÃ¨res
- **Compact** : `10,5:#3498DB` = ~13 caractÃ¨res
- **Gain** : ~62% de rÃ©duction par pixel
- **Pour 20 updates Ã— 8 voisins** : ~3500 caractÃ¨res Ã©conomisÃ©s par requÃªte !

---

## ğŸ¯ POINTS CLÃ‰S

1. **SÃ©paration des prÃ©occupations** :
   - JSON pour la communication rÃ©seau (fiabilitÃ©, standard)
   - Format compact pour les prompts LLM (Ã©conomie de tokens)

2. **Conversion unique** :
   - La conversion JSON â†’ compact se fait **une seule fois** dans `ollama.js`
   - Pas de conversion inverse nÃ©cessaire (lecture seule par le LLM)

3. **Pas de perte d'information** :
   - Le format compact contient toutes les donnÃ©es nÃ©cessaires (x, y, color)
   - Le LLM n'a pas besoin des mÃ©tadonnÃ©es (user_id, timestamp)

4. **Optimisation ciblÃ©e** :
   - Seul Ollama utilise le format compact (contexte limitÃ© Ã  8192 tokens)
   - Anthropic et OpenAI pourraient utiliser le JSON complet (contexte 200k+)

---

## ğŸ“Š FLUX DE DONNÃ‰ES SIMPLIFIÃ‰

```
Agent A dessine â†’ JSON â†’ Serveur â†’ JSON â†’ Agent B reÃ§oit
                                              â†“
                                         Stocke en mÃ©moire
                                              â†“
                                    AgrÃ¨ge pour analyse
                                              â†“
                                    Convertit en compact
                                              â†“
                                    Envoie au LLM
                                              â†“
                                    LLM lit et rÃ©pond
                                              â†“
                                    Agent B dessine â†’ JSON â†’ ...
```

---

**Version** : 1.0  
**Date** : 2025-10-10  
**Auteur** : Olivier Auber & Claude Sonnet 4.5

